Description
===========

This project builds a website for a fictitious real state agency, with offices all around the world. This project is prepared to be deployed in DigitalOcean or Heroku, as both are paid services and this is a learning project, the website is not deployed, although it is still possible to run it in a localhost (see `Usage` section for further information).

The base design is of the website belongs to the course https://www.udemy.com/course/desarrollo-web-completo-con-html5-css3-js-php-y-mysql/, so all credit goes to its creator. However, as I made several changes, leading into a considerably different website, I felt worth to share this version of the website. 

The project is build from scratch without using any framework, under a MVC architecture. The backend is written in PHP and MySQL, using PDO to communicate with the database. For the frontend, the information is presented via HTML embedded in PHP files, the stylesheet is written in SCSS and the client side behavior is controlled by JavaScript. Fetch API is used to communicate client and server at some points when an exchange of information is needed, to request data to some APIs or to submit a form that has been previously prevented.

In addition, the project uses the Node.js toolkit Gulp.js as development aid (see `Developing`), in order to compile the SCSS files, minimize the scripts and improve the image performance.

Usage
======

To run the website in a localhost, follow this steps: 

1. Ensure you have PHP, Composer and a database management software able to work with MySQL databases (such as TablePlus, https://tableplus.com) installed in your computer. 

2. Run `composer install` in the command line to install all the PHP dependencies.

3. Run `npm install` in the command line to install all the Node.js dependencies. After that, run `npm run compile_css`, `npm run export_js` and `npm run improve_images`.

4. Use `BienesRaicesDB.sql` to create the database needed by the project. The tables will be empty, as it is a feature of the application to fill them with the information showed in the website.

5. There is one exception to the previous point. The table called `USUARIOS` does not insert information from the website, as this table is used to store the credentials of the admins and it is not mutable from the website. Use the query defined in `usuarios.sql` to load some admin users to the website. 

6. Create a `.env` file inside `includes` (or change the route to the file in `includes/app.php`). This file must contain all the environment variables needed to correctly run de project. Here is a list of the needed variables:

    - Database variables
        - DB_HOST: The name of the host where the database is located.
        - DB_NAME: The name of the databse.
        - DB_USER: The name of the user owning the database.
        - DB_PASS: The password of the database.
    - Mail provider variables. The website uses PHPMailer to send mails to the user, so it needs a mail provider to correctly send STMP requests. During the development, the selected provider was Brevo (https://www.brevo.com):
        - PHP_MAILER_HOST: The SMTP host name.
        - PHP_MAILER_PORT: The SMTP port.
        - PHP_MAILER_USERNAME: The username used in the mail provider.
        - PHP_MAILER_PASS: The SMTP password generated by the mail provider to stablish SMTP connections.
    - TimeZoneDB API. The website obtains the user timezone from the TimeZoneDB API, using the user-supplied coordinates, so an API key is needed to correctly run the call.
        - TIMEZONEDB_KEY: The key provided by TimeZoneDB to use its API.

7. Send the command line to `public` and run a localhost of your choice (say 3000), using `php -S localhost:3000`. You should find the website typing `localhost:3000` in your chosen browser.

If you have followed this step-by-step tutorial, the website you're now using has the following admin users:
- `admin-madrid@bienesraices.com`
- `admin-miami@bienesraices.com`
- `admin-tokyo@bienesraices.com`
- `admin-new-delhi@bienesraices.com`
- `admin-rio@bienesraices.com`
- `admin-kinshasa@bienesraices.com`

The password for all of them is `123456` (I know, security above all else :satisfied:). There is a small change if you login using different emails: the contact requests asking for a call in a specified time will be shown in the local hour of the chosen office (here, it is understood that `admin-tokyo@bienesraices.com` stands for a office located at Tokyo).

**Note:** `Procfile` and `public/.htaccess` are files created to correctly deploy the website in a DigitalOcean or Heroku server. Therefore, in this usage they are useless and may be deleted. The reason to show them in the repository is to get an accurate representation of an actual website application. In the same way, a repository used to deploy the app will not contain the source code, the gulpfile, and so on, but will contain the build folder created by Gulp.js from the source code.

Developing
==========

If you want to continue developing this project and adding features, feel free to do it! 

First of all, be sure to follow `Usage` section to have the project correctly prepared in your system and ready to be edited. 

You can take advantage of the defined Gulp.js functions to help you in your development:
- `compile_css`: Run this function to compile all the SCSS files into a CSS stylesheet. This CSS file is the one read by the app.
- `export_js`: Run this function to bring together all the JS files into a single, minified Javascript file. This built script is the one used by the app.
- `dev`: If you do not want to run the above functions each time you make a change, this is your function. Run `dev` function and keep the command line open, Gulp.js will compile the CSS file each time a SCSS file register a change, and export the JavaScript code each time a JS file changes.
- `improve_images`: Use this function to improve the size of the images included in `src/img`, as well as to obtain a Webp and an AVIF version.

If you need further Gulp functions, feel free to write them inside `gulpfile.js`.

Other
=====

Author: Tom√°s Senovilla Polo

Email : tspscgs@gmail.com

License: pyreptasks is available under the MIT license. See `LICENSE.txt` for further information.
